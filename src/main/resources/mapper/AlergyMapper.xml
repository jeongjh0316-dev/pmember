<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.pmember.service.AlergyMapper">

    <!-- ë§ˆìŠ¤í„° ì•Œë ˆë¥´ê¸° ì „ì²´ ì¡°íšŒ -->
    <select id="selectAllAlergy" resultType="com.example.pmember.dto.Alergy">
        SELECT
        al_idx,
        al_name,
        al_symptom,
        al_severity
        FROM p_alergy
        ORDER BY al_idx
    </select>

    <!-- íŠ¹ì • íšŒì›ì´ ì²´í¬í•œ ì•Œë ˆë¥´ê¸° al_idx ëª©ë¡ -->
    <select id="selectUserAlergyIdxList" parameterType="string" resultType="int">
        SELECT
        al_idx
        FROM p_member_alergy
        WHERE id = #{id}
        ORDER BY al_idx
    </select>

    <!-- íŠ¹ì • íšŒì› ì•Œë ˆë¥´ê¸° ì „ì²´ ì‚­ì œ -->
    <delete id="deleteUserAlergyById" parameterType="string">
        DELETE FROM p_member_alergy
        WHERE id = #{id}
    </delete>

    <!-- íšŒì› ì•Œë ˆë¥´ê¸° ì¶”ê°€ (1ê±´) -->
    <insert id="insertUserAlergy" parameterType="com.example.pmember.dto.MemberAlergy">
        INSERT INTO p_member_alergy
        (
        id,
        al_idx
        )
        VALUES
        (
        #{id},
        #{al_idx}
        )
    </insert>

    <!-- ğŸ”¹ ì´ íšŒì›ì´ ì•Œë ˆë¥´ê¸°ë¡œ ì¸í•´ í”¼í•´ì•¼ í•˜ëŠ” ìŒì‹ ì´ë¦„ ëª©ë¡ -->
    <select id="selectFoodNamesByMember"
            parameterType="string"
            resultType="string">
        SELECT DISTINCT f.foodmenu_name
        FROM p_member_alergy   ma       -- íšŒì›ì´ ì²´í¬í•œ ì•Œë ˆë¥´ê¸°
        JOIN p_foodmenu_alergy fa
        ON ma.al_idx = fa.al_idx      -- ê°™ì€ ì•Œë ˆë¥´ê¸°ë¥¼ í¬í•¨í•œ ë©”ë‰´ë“¤
        JOIN p_foodmenu        f
        ON fa.foodmenu_idx = f.foodmenu_idx
        WHERE ma.id = #{id}
    </select>

</mapper>
