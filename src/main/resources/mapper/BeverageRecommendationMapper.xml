<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.pmember.service.BeverageRecommendationMapper">

    <!-- ìŒë£Œ ì¶”ì²œ ê²°ê³¼ ê¸°ë¡: id + beveragemenu_idx ë¦¬ìŠ¤íŠ¸ë¡œ ì—¬ëŸ¬ ê±´ INSERT -->
    <insert id="insertBeverageRecommendations">
        INSERT INTO p_beveragemenu_recommendation (id, beveragemenu_idx)
        VALUES
        <foreach collection="menuIdxList" item="idx" separator=",">
            (#{id}, #{idx})
        </foreach>
    </insert>

    <!-- ë§ˆì´í˜ì´ì§€: ìµœê·¼ ìŒë£Œ ì¶”ì²œ ê¸°ë¡ ì¡°íšŒ (p_beveragemenu ì¡°ì¸) -->
    <select id="findRecentBeverageRecommendations"
            parameterType="string"
            resultType="com.example.pmember.dto.BeverageRecommendation">
        SELECT
        r.reco_bev_idx          AS recoBevIdx,
        r.id                    AS id,
        r.beveragemenu_idx      AS beveragemenuIdx,
        r.beveragemenu_ratings  AS beveragemenuRatings,
        r.created_at            AS createdAt,
        b.beveragemenu_name     AS beveragemenuName,
        -- â­ ì´ë¯¸ì§€ ì»¬ëŸ¼ (íŒŒì¼ëª…) â†’ DTO.beveragemenuImage
        b.beveragemenu_image    AS beveragemenuImage
        FROM p_beveragemenu_recommendation r
        JOIN p_beveragemenu b
        ON r.beveragemenu_idx = b.beveragemenu_idx
        WHERE r.id = #{id}
        <!-- ğŸ”‘ ìµœì‹  ì¶”ì²œ ë¬¶ìŒë¶€í„°, ë¬¶ìŒ ì•ˆì—ì„œëŠ” 1ë“±â†’2ë“±â†’3ë“± -->
        ORDER BY r.created_at DESC, r.reco_bev_idx ASC
        LIMIT 21
    </select>

    <!-- ë§ˆì´í˜ì´ì§€: ì„ íƒí•œ reco_bev_idxë“¤ ì‚­ì œ -->
    <delete id="deleteBeverageRecommendations">
        DELETE FROM p_beveragemenu_recommendation
        WHERE id = #{id}
        AND reco_bev_idx IN
        <foreach collection="recoIdxList" item="reco" open="(" separator="," close=")">
            #{reco}
        </foreach>
    </delete>

</mapper>
