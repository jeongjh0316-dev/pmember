<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.pmember.service.DislikeMapper">

    <!-- 회원별 벤(싫어요) 리스트 조회 -->
    <select id="selectDislikeList"
            parameterType="string"
            resultType="com.example.pmember.dto.Dislike">
        SELECT
        dislike_idx AS dislikeIdx,
        id,
        food_name   AS foodName,
        created_at  AS createdAt
        FROM p_dislike
        WHERE id = #{id}
        ORDER BY created_at DESC
    </select>

    <!-- 벤 추가: (id, food_name) 유니크 + 중복 시 created_at 갱신 -->
    <insert id="insertDislike">
        INSERT INTO p_dislike (id, food_name, created_at)
        VALUES (#{id}, #{foodName}, NOW())
        ON DUPLICATE KEY UPDATE
        created_at = NOW()
    </insert>

    <!-- 벤 삭제: 이 유저 + 이 음식 하나만 삭제 -->
    <delete id="deleteDislike">
        DELETE FROM p_dislike
        WHERE id = #{id}
        AND food_name = #{foodName}
    </delete>

    <!-- 필터링용: 이 유저가 벤한 메뉴 이름 목록 -->
    <select id="selectFoodNamesByMember"
            parameterType="string"
            resultType="string">
        SELECT food_name
        FROM p_dislike
        WHERE id = #{id}
    </select>

</mapper>
