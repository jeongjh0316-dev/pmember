<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.pmember.service.FoodRecommendationMapper">

    <!-- ÏùåÏãù Ï∂îÏ≤ú Í≤∞Í≥º Í∏∞Î°ù: id + foodmenu_idx Î¶¨Ïä§Ìä∏Î°ú Ïó¨Îü¨ Í±¥ INSERT -->
    <insert id="insertFoodRecommendations">
        INSERT INTO p_food_recommendation (id, foodmenu_idx)
        VALUES
        <foreach collection="menuIdxList" item="idx" separator=",">
            (#{id}, #{idx})
        </foreach>
    </insert>

    <!-- ÎßàÏù¥ÌéòÏù¥ÏßÄ: ÏµúÍ∑º ÏùåÏãù Ï∂îÏ≤ú Í∏∞Î°ù Ï°∞Ìöå (p_foodmenu Ï°∞Ïù∏Ìï¥ÏÑú Ïù¥Î¶Ñ/Ïù¥ÎØ∏ÏßÄÍπåÏßÄ Í∞ÄÏ†∏Ïò§Í∏∞) -->
    <select id="findRecentFoodRecommendations"
            parameterType="string"
            resultType="com.example.pmember.dto.FoodRecommendation">
        SELECT
        r.reco_idx           AS recoIdx,
        r.id                 AS id,
        r.foodmenu_idx       AS foodmenuIdx,
        r.foodmenu_ratings   AS foodmenuRatings,
        r.created_at         AS createdAt,
        f.foodmenu_name      AS foodmenuName,
        -- ‚≠ê Ïù¥ÎØ∏ÏßÄ Ïª¨Îüº (ÌååÏùºÎ™Ö) ‚Üí DTO.foodmenuImage
        f.foodmenu_image     AS foodmenuImage
        FROM p_food_recommendation r
        JOIN p_foodmenu f
        ON r.foodmenu_idx = f.foodmenu_idx
        WHERE r.id = #{id}
        <!-- üîë ÏµúÏã† Ï∂îÏ≤ú Î¨∂ÏùåÎ∂ÄÌÑ∞, Î¨∂Ïùå ÏïàÏóêÏÑúÎäî 1Îì±‚Üí2Îì±‚Üí3Îì± -->
        ORDER BY r.created_at DESC, r.reco_idx ASC
        LIMIT 21
    </select>

    <!-- ÎßàÏù¥ÌéòÏù¥ÏßÄ: ÏÑ†ÌÉùÌïú reco_idxÎì§ ÏÇ≠Ï†ú -->
    <delete id="deleteFoodRecommendations">
        DELETE FROM p_food_recommendation
        WHERE id = #{id}
        AND reco_idx IN
        <foreach collection="recoIdxList" item="reco" open="(" separator="," close=")">
            #{reco}
        </foreach>
    </delete>

</mapper>
