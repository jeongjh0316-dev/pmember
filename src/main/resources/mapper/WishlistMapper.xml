<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.pmember.service.WishlistMapper">

    <!-- 찜 추가: (id, food_name) 유니크 + 중복 시 created_at 갱신 -->
    <insert id="insertWish">
        INSERT INTO p_wishlist (id, food_name, created_at)
        VALUES (#{id}, #{foodName}, NOW())
        ON DUPLICATE KEY UPDATE
        created_at = NOW()
    </insert>

    <!-- 찜 삭제 -->
    <delete id="deleteWish">
        DELETE FROM p_wishlist
        WHERE id = #{id}
        AND food_name = #{foodName}
    </delete>

    <!-- 회원의 찜 목록 조회 (+ 메뉴 이미지까지 조인) -->
    <select id="selectWishlistByMember"
            resultType="com.example.pmember.dto.WishItem">
        SELECT
        w.wish_idx       AS wishIdx,
        w.id             AS id,
        w.food_name      AS foodName,
        w.created_at     AS createdAt,
        -- ⭐ p_foodmenu.foodmenu_image (파일명) → DTO.foodImage
        f.foodmenu_image AS foodImage
        FROM p_wishlist w
        LEFT JOIN p_foodmenu f
        ON w.food_name = f.foodmenu_name
        WHERE w.id = #{id}
        ORDER BY w.created_at DESC
    </select>

</mapper>
